<!DOCTYPE html>
<html lang="zxx">

<head>
    <meta charset="UTF-8">
    <meta name="description" content="Male_Fashion Template">
    <meta name="keywords" content="Male_Fashion, unica, creative, html">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>ZenoX Hub</title>

    <!-- Google Font -->
    <link href="https://fonts.googleapis.com/css2?family=Nunito+Sans:wght@300;400;600;700;800;900&display=swap"
    rel="stylesheet">

    <!-- Css Styles -->
    <link rel="stylesheet" href="css/bootstrap.min.css" type="text/css">
    <link rel="stylesheet" href="css/font-awesome.min.css" type="text/css">
    <link rel="stylesheet" href="css/elegant-icons.css" type="text/css">
    <link rel="stylesheet" href="css/magnific-popup.css" type="text/css">
    <link rel="stylesheet" href="css/nice-select.css" type="text/css">
    <link rel="stylesheet" href="css/owl.carousel.min.css" type="text/css">
    <link rel="stylesheet" href="css/slicknav.min.css" type="text/css">
    <link rel="stylesheet" href="css/style.css" type="text/css">

    <style>
        #couponDiv {
            display: none;
        }
        #overlay {
            display: none;
        }
        #hello {
            color: rgb(110, 101, 104);
        }

        .price-container {
            display: flex;
            align-items: center;
            gap: 10px; /* Adjust this value to control space between prices */
        }

        .strikethrough {
            text-decoration: line-through;
            color: #999; /* Optional: changes the color of the struck-through price */
        }
    </style>
</head>

<body>
    <!-- Page Preloder -->
    <div id="preloder">
        <div class="loader"></div>
    </div>

    <!-- Offcanvas Menu Begin -->
    <div class="offcanvas-menu-overlay"></div>
    <div class="offcanvas-menu-wrapper">
        <div class="offcanvas__option">
            <div class="offcanvas__links">
                <a href="#">Sign in</a>
                <a href="#">FAQs</a>
            </div>
            <div class="offcanvas__top__hover">
                <span>Usd <i class="arrow_carrot-down"></i></span>
                <ul>
                    <li>USD</li>
                    <li>EUR</li>
                    <li>USD</li>
                </ul>
            </div>
        </div>
        <div class="offcanvas__nav__option">
            <a href="#" class="search-switch"><img src="img/icon/search.png" alt=""></a>
            <a href="#"><img src="img/icon/heart.png" alt=""></a>
            <a href="/cart"><img src="img/icon/cart.png" alt=""> <span>0</span></a>
            <div class="price">$0.00</div>
        </div>
        <div id="mobile-menu-wrap"></div>
        <div class="offcanvas__text">
            <p>Free shipping, 30-day return or refund guarantee.</p>
        </div>
    </div>
    <!-- Offcanvas Menu End -->

    <!-- Header Section Begin -->
    <header class="header">
        <div class="header__top">
            <div class="container">
                <div class="row">
                    <div class="col-lg-6 col-md-7">
                        <div class="header__top__left">
                            <p>Free shipping, 30-day return or refund guarantee.</p>
                        </div>
                    </div>
                    <div class="col-lg-6 col-md-5">
                        <div class="header__top__right">
                            <div class="header__top__links">
                                <a href="/user-profile">Profile</a>
                                <a href="/logout">LogOut</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="container">
            <div class="row">
                <div class="col-lg-3 col-md-3">
                    <div class="header__logo">
                        <h3><strong>ZenoX Hub</strong></h3>
                        
                    </div>
                </div>
                <div class="col-lg-6 col-md-6">
                    <nav class="header__menu mobile-menu">
                        <ul>
                            <li class="active"><a href="/home">Home</a></li>
                            <li><a href="/shop">Shop</a></li>
                            <li><a href="/contact">Contacts</a></li>
                        </ul>
                    </nav>
                </div>
                <div class="col-lg-3 col-md-3">
                    <div class="header__nav__option">
                        <a href="/wishlist"><img src="img/icon/heart.png" alt=""></a>
                        <a href="/cart"><img src="img/icon/cart.png" alt=""> <span>0</span></a>
                    </div>
                </div>
            </div>
            <div class="canvas__open"><i class="fa fa-bars"></i></div>
        </div>
    </header>
    <!-- Header Section End -->

    <!-- Breadcrumb Section Begin -->
    <section class="breadcrumb-option">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="breadcrumb__text">
                        <h4>Shopping Cart</h4>
                        <div class="breadcrumb__links">
                            <a href="/home">Home</a>
                            <a href="/shop">Shop</a>
                            <span>Shopping Cart</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- Breadcrumb Section End -->

    <!-- Shopping Cart Section Begin -->
    <section class="shopping-cart spad">
        <div class="container">
            <div class="row">
                <div class="col-lg-8">
                    <div class="shopping__cart__table">

                        <div class="container my-1">
                            <button class="btn btn-danger" id="toggleButton">&#9660; Show Coupon</button>
                            <div class="overlay" id="overlay"></div>
                            <div id="couponDiv" class="coupon-content">
                                <% if (allCoupon.length > 0) { %>
                            <% for(let i =0;i<allCoupon.length;i++) {%> 
                                <div class="row">
                                    <div class="col-12">
                                        <div class="coupon bg-white rounded mb-3 d-flex justify-content-between">
                                            <div class="kiri p-3">
                                                <div class="icon-container">
                                                    <div class="icon-container_box">
                                                         <img src="data:image/png;base64,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" width="85" alt="totoprayogo.com" class="" />
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="tengah py-3 d-flex w-100 justify-content-start">
                                                <div>
                                                    <span class="badge badge-success">Valid</span>
                                                    <h3 class="lead"><%=allCoupon[i].code %></h3>
                                                    <p class="text-muted mb-0"><%=allCoupon[i].description %></p>
                                                </div>
                                            </div>
                                            <div class="kanan">
                                                <div class="info m-3 d-flex align-items-center">
                                                    <div class="w-100">
                                                        <div class="block">
                                                            <span class="time font-weight-light">
                                                                <span><%= allCoupon[i].maxUsers %> left</span>
                                                            </span>
                                                        </div>
                                                        <button class="btn btn-danger copyButton" data-coupon="<%=allCoupon[i].code%>">COPY</button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <%}%>
                                <% } else { %>
                                    <div class="row">
                                        <div class="col-12">
                                            <div class="alert alert-info text-center" role="alert">
                                                No coupons available at the moment.
                                            </div>
                                        </div>
                                    </div>
                                <% } %>
                            </div>
                        </div>

                        <table>
                            <thead>
                                <tr>
                                    <th>Product</th>
                                    <th>Quantity</th>
                                    <th style="text-align: center;">Total</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody>
                                <input type="hidden" value="<%= couponDiscount %>" id="couponDis">
                                <%if ( cart!==null ){ 
                                    if(cart.items.length>0){
                                    for(let i=0;i<cart.items.length;i++){%>
                                <tr>
                                    <td class="product__cart__item">
                                        <div class="product__cart__item__pic">
                                            <img height="110px" width="80px" src="productImages/<%=cart.items[i].ProductId.images[0]%>" alt="">
                                        </div>
                                        <div class="product__cart__item__text">
                                            <h6><%=cart.items[i].ProductId.name%></h6>
                                        <div class="price-container">
                                            <h5 class="strikethrough" style="color: #999;"><%= cart.items[i].price%>/-</h5>
                                            <h5 id="prodPrice" data-product-id="<%=cart.items[i].ProductId._id%>" data-title="Price"> <%=cart.items[i].ProductId.price%>/-</h5>
                                        </div>
                                        </div>
                                    </td>

                                    <td>
                                        <div class="detail-qty m-auto">
                                            <a  href="#" style="height: 30px; width: 30px;" class="btn btn-secondary qty-down" data-product-id="<%= cart.items[i].ProductId._id %>">
                                                <i class="fi-rs-angle-small-down"></i><span>-</span>
                                            </a>
                                            <span class="qty-val" data-product-id="<%= cart.items[i].ProductId._id %>"><%= cart.items[i].quantity %></span>
                                            <a href="#" style="height: 30px; width: 30px;" class="btn btn-secondary qty-up" data-product-id="<%= cart.items[i].ProductId._id %>">
                                                <i class="fi-rs-angle-small-up"></i><span style="margin: -10px;">+</span>
                                            </a> 
                                        </div>
                                    </td>

                                    <td class="cart__price text-right" data-title="Subtotal" id="subtotal">
                                        <span id="totalAmount">Rs <%= cart.items[i].ProductId.price*cart.items[i].quantity %>.00</span>
                                        </td>
                                        
                                    <td class="cart__close">
                                    <i class="fa fa-close ml-5" onclick="removeProductCart('<%= cart.items[i].ProductId._id%>')"></i>
                                    </td>

                                    <%}}}%>
                                </tr>
                                
                            </tbody>
                        </table>
                    </div>
                    <div class="row">
                        <div class="col-lg-6 col-md-6 col-sm-6">
                            <div class="continue__btn">
                                <a href="/shop">Continue Shopping</a>
                            </div>
                        </div>
                        <div class="col-lg-6 col-md-6 col-sm-6">
                            <!--<div class="continue__btn update__btn">
                                <a href="#"><i class="fa fa-spinner"></i> Update cart</a>
                            </div> --!>
                        </div>
                    </div>
                </div>
                <div class="col-lg-4"> 
                    <div class="cart__discount">
                        <h6>Discount codes</h6>
                        <form id="couponForm">
                            <input type="text" id="couponCode" value="<%=cart.coupon%>">
                            <button onclick="applyCoupon()" type="submit">Apply</button>
                        </form>
                        <% if (cart.coupon) { %>
                        <button class="btn btn" type="button" onclick="removeCoupon('<%=cart.coupon%>')">remove<i class=""></i></button>
                        <%} %>
                    </div>
                    
                    <div class="cart__total">
                        
                        <h6>Cart total</h6>
                        <ul>
                            <% if(cart) {%>
                                <li>Shipping <span>Free Shipping</span></li>
                                <li>Subtotal <span data-title="Subtotal" class="cart_subtotal">Rs <%= cart.billTotal %>.00/-</span></li>                       
                                <li>Total <span class="cart_total_amount">Rs <%= cart.billTotal %>.00/-</span></li>
                            <%} else{ %>
                                <li>Shipping <span>Free Shipping</span></li>
                                <li>Subtotal <span>Rs 0/-</span></li>
                                <li>Total <span>Rs 0/-</span></li>
                            <%}%>
                        </ul>
                        <button class="primary-btn" id="checkoutButton" onsubmit="checkout">Proceed to checkout</button>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- Shopping Cart Section End -->

    <!-- Footer Section Begin -->
    <footer class="footer">
        <div class="container">
            <div class="row">
                <div class="col-lg-3 col-md-6 col-sm-6">
                    <div class="footer__about">
                        <div class="footer__logo">
                            <h3 style="color: white;"><strong>ZenoX Hub</strong></h3>
                            <!-- <a href="#"><img src="img/footer-logo.png" alt=""></a> -->
                        </div>
                        <p>The customer is at the heart of our unique business model, which includes design.</p>
                        <a href="#"><img src="img/payment.png" alt=""></a>
                    </div>
                </div>
                <div class="col-lg-2 offset-lg-1 col-md-3 col-sm-6">
                    <div class="footer__widget">
                        <h6>Shopping</h6>
                        <ul>
                            <li><a href="/shop">Men</a></li>
                            <li><a href="/shop">Women</a></li>
                            <li><a href="/shop">Kids</a></li>
                        </ul>
                    </div>
                </div>
                <div class="col-lg-2 col-md-3 col-sm-6">
                    <div class="footer__widget">
                        <h6>About</h6>
                        <ul>
                            <li><a href="/contact">Contact Us</a></li>
                        </ul>
                    </div>
                </div>
                <div class="col-lg-3 offset-lg-1 col-md-6 col-sm-6">
                    <div class="footer__widget">
                        <h6>NewLetter</h6>
                        <div class="footer__newslatter">
                            <p>Be the first to know about new arrivals, look books, sales & promos!</p>
                            <form action="#">
                                <input type="text" placeholder="Your email">
                                <button type="submit"><span class="icon_mail_alt"></span></button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-lg-12 text-center">
                    <div class="footer__copyright__text">
                        <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
                        <p>Copyright ©
                            <script>
                                document.write(new Date().getFullYear());
                            </script>2020
                            All rights reserved | This template is made with <i class="fa fa-heart-o"
                            aria-hidden="true"></i> by <a href="https://colorlib.com" target="_blank">Colorlib</a>
                        </p>
                        <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
                    </div>
                </div>
            </div>
        </div>
    </footer>
    <!-- Footer Section End -->

    <!-- Search Begin -->
    <div class="search-model">
        <div class="h-100 d-flex align-items-center justify-content-center">
            <div class="search-close-switch">+</div>
            <form class="search-model-form">
                <input type="text" id="search-input" placeholder="Search here.....">
            </form>
        </div>
    </div>
    <!-- Search End -->

    <!-- Js Plugins -->
    <script src="js/jquery-3.3.1.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/jquery.nice-select.min.js"></script>
    <script src="js/jquery.nicescroll.min.js"></script>
    <script src="js/jquery.magnific-popup.min.js"></script>
    <script src="js/jquery.countdown.min.js"></script>
    <script src="js/jquery.slicknav.js"></script>
    <script src="js/mixitup.min.js"></script>
    <script src="js/owl.carousel.min.js"></script>
    <script src="js/main.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    

    <script>

        document.addEventListener('DOMContentLoaded', function() {
            var copyButtons = document.getElementsByClassName('copyButton');
            for (var i = 0; i < copyButtons.length; i++) {
                copyButtons[i].addEventListener('click', function() {
                    var couponText = this.getAttribute('data-coupon');
                    navigator.clipboard.writeText(couponText).then(function() {
                        Swal.fire({
                            title: "Success",
                            text: "Code copied to the Clipboard",
                            icon: "success",
                            confirmButtonText: "Ok",
                            timer: 1500,
                            showConfirmButton: false
                        });
                    }, function(err) {
                        console.error('Could not copy text: ', err);
                        Swal.fire({
                            title: "Error",
                            text: "Failed to copy code. Please try again.",
                            icon: "error",
                            confirmButtonText: "Ok"
                        });
                    });
                });
            }
        });
        
        document.addEventListener('DOMContentLoaded', function() {
            var toggleButton = document.getElementById('toggleButton');
            var couponDiv = document.getElementById('couponDiv');
            var overlay = document.getElementById('overlay');

            toggleButton.addEventListener('click', function() {
                if (couponDiv.style.display === 'none' || couponDiv.style.display === '') {
                    couponDiv.style.display = 'block';
                    overlay.style.display = 'block';
                    this.innerHTML = '&#9650; Hide Coupon';
                } else {
                    couponDiv.style.display = 'none';
                    overlay.style.display = 'none';
                    this.innerHTML = '&#9660; Show Coupon';
                }
            });

            overlay.addEventListener('click', function() {
                couponDiv.style.display = 'none';
                this.style.display = 'none';
                toggleButton.innerHTML = '&#9660; Show Coupon';
            });
        });
</script>



    <script>
        document.getElementById('checkoutButton').addEventListener('click', checkout);

        async function checkout() {
            try {
                const response = await fetch("/checkOut", {
                    method: "GET",
                    headers: { 
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({})  // If you need to send any data, include it here
                });

                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }

                const data = await response.json();
                console.log(data);  
                
                window.location.href = "/checkOut";  // Redirecting to the checkout page
            } catch (error) {
                console.error('There has been a problem with your fetch operation:', error);
            }
        }
    </script>
    
    <script>
    document.addEventListener('DOMContentLoaded', () => {
        document.querySelectorAll('.qty-up').forEach(button => {
            button.addEventListener('click', async (event) => {
                const productId = button.getAttribute('data-product-id');
                const quantityElement = document.querySelector(`.qty-val[data-product-id="${productId}"]`);
                const currentQuantity = parseInt(quantityElement.textContent);
                updateQuantity(productId, currentQuantity + 1);

                console.log(productId, "productId----------");
                console.log(quantityElement, "quantityElement---------");
                console.log(currentQuantity, "currentQuantity=------------");
            });
        });

        document.querySelectorAll('.qty-down').forEach(button => {
            button.addEventListener('click', async (event) => {
                const productId = button.getAttribute('data-product-id');
                const quantityElement = document.querySelector(`.qty-val[data-product-id="${productId}"]`);
                const currentQuantity = parseInt(quantityElement.textContent);
                if (currentQuantity > 1) {
                    updateQuantity(productId, currentQuantity - 1);
                }
            });
        });

        function updateQuantity(productId, quantity) {
            fetch(`/increaseQty/${productId}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ quantity })
            })
            .then(response => response.json())
            .then(data => {
                console.log(data);
                if (data.success) {
                    const quantityElement = document.querySelector(`.qty-val[data-product-id="${productId}"]`);
                    quantityElement.textContent = quantity;

                    // Update subtotal
                    const priceElement = document.querySelector(`#prodPrice[data-product-id="${productId}"]`);
                    const price = parseFloat(priceElement.textContent.replace(/[^0-9.-]+/g, '')); 
                    const subtotalElement = quantityElement.parentElement.parentElement.nextElementSibling; // Get next sibling (subtotal)
                   
                    const newSubtotal = price * quantity;
                    subtotalElement.querySelector('span').textContent = `Rs ${newSubtotal.toFixed(2)}`;
                    updateCartTotal();
                } else if (!data.success) {
                    const quantityElement = document.querySelector(`.qty-val[data-product-id="${productId}"]`);
                    quantityElement.textContent = quantity - 1;
                    Swal.fire({
                        title: "Unavailable",
                        text: data.message,
                        icon: "warning",
                        confirmButtonText: "OK"
                    }).then((result) => {
                        if (result.isConfirmed) {
                            location.reload();
                        }
                    });
                }
            })
            .catch(error => {
                console.error('Error:', error);
            });
        }

        function updateCartTotal() {
            return new Promise((resolve, reject) => {
               
                const subtotalElements = document.querySelectorAll('.text-right[data-title="Subtotal"] span');
                console.log(subtotalElements, '....................................subtotalElement');

                
                let subtotal = 0;
                subtotalElements.forEach(subtotalElement => {
                    const value = parseFloat(subtotalElement.textContent.replace(/[^0-9.-]+/g, '')); 
                    if (!isNaN(value)) {
                        subtotal += value;
                    }
                    console.log(subtotalElement.textContent, '....................................subtotal.textContent');
                    console.log(subtotal, '....................................subtotal');
                });

                
                const cartSubtotalElement = document.querySelector('.cart_subtotal');
                const cDiscount = 1-(document.getElementById('couponDis').value/100)
                console.log(cDiscount,';;;;;;;;;;;;;;;;;;;;;;');
                cartSubtotalElement.textContent = `Rs ${(subtotal*cDiscount).toFixed(2)}/-`;
                console.log(cartSubtotalElement, '....................................cartSubtotalElement');

                
                const totalAmountElement = document.querySelector('.cart_total_amount');
                totalAmountElement.textContent = `Rs ${(subtotal*cDiscount).toFixed(2)}/-`;
                console.log(totalAmountElement, '....................................totalAmountElement');

                resolve();
            });
        }

                document.getElementById('checkoutButton').addEventListener('click', function(event) {
                event.preventDefault(); 

                updateCartTotal().then(() => {
                
                window.location.href = "/checkOut";
                }).catch(error => {
                console.error('Failed to update cart total before checkout:', error);
                
                });
            });
         });
</script>

        <!-- delete product -->

        <script>
            function removeProductCart(productId) {
        swal.fire({
            title: "Are you sure?",
            text: "Do you want to remove this product from your cart?",
            icon: "warning",
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Yes, remove it!'
        }).then((result) => {
            if (result.isConfirmed) {
                fetch('/cart-delete', {
                    method: "POST",
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        productId
                    })
                })
                .then((response) => {
                    if (response.ok) {
                        return response.json();
                    } else {
                        throw new Error('Network response was not ok.');
                    }
                })
                .then((data) => {
                    if (data.success) {
                        // Product removed successfully
                        swal.fire({
                            title: 'Product Removed',
                            text: '',
                            icon: "success",
                            type: 'success',
                            timer: 1500,
                            timerProgressBar: true,
                        }).then(() => {
                          location.reload(); // Reload the page after successful removal
                        });
                    } 
                    //else {
                    //     // Handle deletion failure
                    //     swal.fire('Error Deleting product', data.message, 'error');
                    // }
                })
                .catch((error) => {
                    // Handle errors during fetch
                    swal.fire('Error', 'An error occurred while removing the product.', 'error');
                    console.error('Fetch Error:', error);
                });
            }
        });
    }
        </script>

        
W
    <script>
        document.getElementById('couponForm').addEventListener('submit', function(event) {
        event.preventDefault();
        applyCoupon();
    });

    async function applyCoupon() {
    event.preventDefault(); // Add this line
    try {
        let coupon = document.getElementById('couponCode').value;
        let response = await fetch("/applyCoupon", {
            method: "POST",
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({coupon})
        });

        let responseData = await response.json();
        if (response.status == 200) {
            swal.fire({
                title: "Success",
                text: responseData.message,
                icon: "success",
                confirmButtonText: "OK"
            }).then(() => {
                window.location.reload();
            });
        } else {
            swal.fire({
                title: "Error",
                text: responseData.message,
                icon: "error",
                confirmButtonText: "OK"
            });
        }
    } catch (error) {
        console.error("Error applying coupon:", error);
        swal.fire({
            title: "Error",
            text: error.message,
            icon: "error",
            confirmButtonText: "OK"
        });
    }
}


    async function removeCoupon(coupon){
        try{ 
                 
           //console.log(coupon,'.................................');
        let res = await fetch("/removeCoupon",{
            method:'POST',
            headers:{
                "Content-Type":'application/json'
            },
            body:JSON.stringify({coupon})
        })
      //  console.log(res,"ressss")
        let responseData = await res.json()
      //  console.log(responseData,"responseData")
        if(res.status==200){
            swal.fire({
                        title:"Sucess",
                        text:responseData.message,
                        icon:"Success",
                        confirmButtonText:"OK"
                    }).then(()=>{
                        window.location.reload()
                    })
                }
                else{
                    swal.fire({
                        title:"error",
                        text:responseData.message,
                        icon:"error",
                        confirmButtonText:"OK"
                    })
                }
    }catch(error){
        console.error("Error removing coupon:", error);
        swal.fire({
            title: "Error",
            text: error.message,
            icon: "error",
            confirmButtonText: "OK"
        });
    }
}
        
    </script>



<% if (!cart || cart.items.length === 0) { %>
    <script>
        Swal.fire({
            title: 'Cart Empty!',
            text: 'Your cart is currently empty.',
            icon: 'info',
            confirmButtonText: 'Go Shopping'
        }).then((result) => {
            if (result.isConfirmed) {
                // Redirect them to the shop page
                window.location.href = '/shop';
            }
        });
    </script>
<% } %>
</body>

</html>