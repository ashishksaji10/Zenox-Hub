<!DOCTYPE HTML>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>ZenoX Hub</title>
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta property="og:title" content="">
    <meta property="og:type" content="">
    <meta property="og:url" content="">
    <meta property="og:image" content="">
    <!-- Favicon -->
    <link rel="shortcut icon" type="image/x-icon" href="adminassets/imgs/theme/favicon.svg">
    <!-- Template CSS -->
    <link href="adminassets/css/main.css" rel="stylesheet" type="text/css" />
</head>

<body>
    <div class="screen-overlay"></div>
    <aside class="navbar-aside" id="offcanvas_aside">
        <div class="aside-top">
            <a href="/admin/dashboard" class="brand-wrap">
                <img src="" class="logo" alt="">
                <h4 style="color: black;">ZenoX Hub</h4>
            </a>
            <div>
                <button class="btn btn-icon btn-aside-minimize"> <i class="text-muted material-icons md-menu_open"></i>
                </button>
            </div>
        </div>
        <nav>
            <ul class="menu-aside">
                <li class="menu-item">
                    <a class="menu-link" href="/admin/dashboard"> 
                        <i class="icon material-icons md-person"></i>
                        <span class="text">Dashboard</span>
                    </a>
                </li>
    
                <li class="menu-item">
                    <a class="menu-link" href="/admin/userlist"> 
                        <i class="icon material-icons md-person"></i>
                        <span class="text">Users</span>
                    </a>
                </li>
                <li class="menu-item">
                    <a class="menu-link" href="/admin/product"> 
                        <i class="icon material-icons md-shopping_bag"></i>
                        <span class="text">Products</span>
                    </a>
                </li>
                <li class="menu-item">
                    <a class="menu-link" href="/admin/category"> 
                        <i class="icon material-icons md-category"></i>
                        <span class="text">Categories</span>
                    </a>
                </li>
                <li class="menu-item">
                    <a class="menu-link" href="/admin/order"> 
                        <i class="icon material-icons md-local_shipping"></i>
                        <span class="text">Orders</span>
                    </a>
                </li>
                <li class="menu-item has-submenu">
                    <a class="menu-link" href="page-transactions-1.html"> <i class="icon material-icons md-local_offer"></i>
                        <span class="text">Offers</span>
                    </a>
                    <div class="submenu">
                        <a href="/admin/categoryoffer">Category offer</a>
                        <a href="/admin/productoffer">Product offer</a>
                    </div>
                </li>
               
                <li class="menu-item">
                    <a class="menu-link" href="/admin/coupon"> 
                        <i class="icon material-icons md-apps"></i>
                        <span class="text">Coupon</span>
                    </a>
                </li>
               
                <li class="menu-item ">
                    <a class="menu-link" href="/admin/salesReport"> <i class="icon material-icons md-assessment"></i>
                        <span class="text">Sales Report</span>
                    </a>
                   
                </li>
                <li class="menu-item">
                    <a class="menu-link" href="/admin/logout"> 
                        <i class="icon material-icons md-exit_to_app"></i>
                        <span class="text">Logout</span>
                    </a>
                </li>
            </ul>
        </nav>
    </aside>
    <main class="main-wrap">
        <header class="main-header navbar">
            <div class="col-search">
            </div>
            <div class="col-nav">
                <button class="btn btn-icon btn-mobile me-auto" data-trigger="#offcanvas_aside"> <i class="material-icons md-apps"></i> </button>
                <ul class="nav">
                    <!-- <li class="nav-item">
                        <a class="nav-link btn-icon" href="#">
                            <i class="material-icons md-notifications animation-shake"></i>
                            <span class="badge rounded-pill">3</span>
                        </a>
                    </li> -->
                    <li class="nav-item">
                        <a class="nav-link btn-icon darkmode" href="#"> <i class="material-icons md-nights_stay"></i> </a>
                    </li>
                    <!-- <li class="nav-item">
                        <a href="#" class="requestfullscreen nav-link btn-icon"><i class="material-icons md-cast"></i></a>
                    </li> -->
                    <li class="dropdown nav-item">
                        <a class="dropdown-toggle" data-bs-toggle="dropdown" href="#" id="dropdownLanguage" aria-expanded="false"><i class="material-icons md-public"></i></a>
                        <div class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdownLanguage">
                            <a class="dropdown-item text-brand" href="#"><img src="adminassets/imgs/theme/flag-us.png" alt="English">English</a>
                            <!-- <a class="dropdown-item" href="#"><img src="adminassets/imgs/theme/flag-fr.png" alt="Français">Français</a>
                            <a class="dropdown-item" href="#"><img src="adminassets/imgs/theme/flag-jp.png" alt="Français">日本語</a>
                            <a class="dropdown-item" href="#"><img src="adminassets/imgs/theme/flag-cn.png" alt="Français">中国人</a> -->
                        </div>
                    </li>
                    <li class="dropdown nav-item">
                        <a class="dropdown-toggle" data-bs-toggle="dropdown" href="#" id="dropdownAccount" aria-expanded="false"> <img class="img-xs rounded-circle" src="adminassets/imgs/people/avatar2.jpg" alt="User"></a>
                        <div class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdownAccount">
                            <!-- <a class="dropdown-item" href="#"><i class="material-icons md-perm_identity"></i>Edit Profile</a>
                            <a class="dropdown-item" href="#"><i class="material-icons md-settings"></i>Account Settings</a>
                            <a class="dropdown-item" href="#"><i class="material-icons md-account_balance_wallet"></i>Wallet</a>
                            <a class="dropdown-item" href="#"><i class="material-icons md-receipt"></i>Billing</a>
                            <a class="dropdown-item" href="#"><i class="material-icons md-help_outline"></i>Help center</a>
                            <div class="dropdown-divider"></div> -->
                            <a class="dropdown-item text-danger" href="/admin/logout"><i class="material-icons md-exit_to_app"></i>Logout</a>
                        </div>
                    </li>
                </ul>
            </div>
        </header>
        <section class="content-main">
            <div class="content-header">
                <div>
                    <h2 class="content-title card-title">Create Coupon </h2>

                </div>

                <div>
                    <!-- <input type="text" placeholder="Search Categories" class="form-control bg-white"> -->
                </div>
            </div>
            <div class="card">
                <div class="card-body">
                        <div class="mb-4">
                            <label for="couponName" class="form-label">Coupon Name</label>
                            <input type="text" placeholder="Type here" class="form-control" name="name" id="couponName"
                                required />
                            <p id="nameError" class="text-danger"></p>
                        </div>

                        <div class="mb-4">
                            <label for="couponCode" class="form-label">Coupon Code</label>
                            <div class="input-group mb-3">
                                <input type="text" class="form-control" name="code" id="couponCode"
                                    placeholder="Generate or type" aria-label="Coupon code" required>
                                <button class="btn btn-primary" type="button" id="generateCode">Generate Code</button>
                            </div>
                        </div>

                        <div class="mb-4">
                            <label class="form-label">Description</label>
                            <textarea placeholder="Type here" class="form-control" name="description" id="description"
                                required></textarea>
                            <p id="descriptionError" class="text-danger"></p>
                        </div>

                        <div class="mb-4">
                            <label for="discountPercentage" class="form-label">Discount Percentage (%)</label>
                            <input type="number" class="form-control" min="0" name="discountPercentage"
                                id="discountPercentage" required />
                            <p id="discountPercentageError" class="text-danger"></p>
                        </div>

                        <div class="mb-4">
                            <label for="minPurchaseAmount" class="form-label">Minimum Purchase Amount</label>
                            <input type="number" class="form-control" name="minPurchaseAmount" id="minPurchaseAmount"
                                required />
                            <p id="minimumAmountError" class="text-danger"></p>
                        </div>

                        <div class="mb-4">
                            <label for="maxPurchaseAmount" class="form-label">Maximum Purchase Amount</label>
                            <input type="number" class="form-control" name="maxPurchaseAmount" id="maxPurchaseAmount"
                                required />
                            <p id="maximumAmountError" class="text-danger"></p>
                        </div>

                        <div class="mb-4">
                            <label for="expirationDate" class="form-label">Expiration Date</label>
                            <input type="date" class="form-control" name="expirationDate" id="expirationDate"
                                required />
                            <p id="expirationDateError" class="text-danger"></p>
                        </div>

                        <div class="mb-4">
                            <label for="maxUsers" class="form-label">Maximum Users Allowed</label>
                            <input type="number" class="form-control" name="maxUsers" id="maxUsers" required />
                            <p id="maxUsersError" class="text-danger"></p>
                        </div>

                        <div class="d-grid">
                            <button type="submit" class="btn btn-primary" id="submitForm" onclick="submitForm(event)">Create Coupon</button>
                        </div>
                    <div class="mt-3">
                        <a href="/admin/coupon" class="btn btn-secondary">Go Back</a>
                    </div>
                </div>
            </div>

        </section> <!-- content-main end// -->
        <footer class="main-footer font-xs">
            <div class="row pb-30 pt-15">
                <div class="col-sm-6">
                    <script>
                        document.write(new Date().getFullYear())
                    </script> ©, Evara - HTML Ecommerce Template .
                </div>
                <div class="col-sm-6">
                    <div class="text-sm-end">
                        All rights reserved
                    </div>
                </div>
            </div>
        </footer>
    </main>
    <script src="adminassets/js/vendors/jquery-3.6.0.min.js"></script>
    <script src="adminassets/js/vendors/bootstrap.bundle.min.js"></script>
    <script src="adminassets/js/vendors/select2.min.js"></script>
    <script src="adminassets/js/vendors/perfect-scrollbar.js"></script>
    <script src="adminassets/js/vendors/jquery.fullscreen.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <!-- Main Script -->
    <script src="adminassets/js/main.js" type="text/javascript"></script>


    <script>
        document.getElementById('generateCode').onclick = function () {
            const randomCode = 'CP' + Math.random().toString(36).substr(2, 8).toUpperCase();
            document.getElementById('couponCode').value = randomCode;
        };
    </script>


<script>
    document.addEventListener('DOMContentLoaded', function () {
        const today = new Date();
        const tomorrow = new Date(today);
        tomorrow.setDate(tomorrow.getDate() + 1);
        const formattedDate = tomorrow.toISOString().split('T')[0];

        const expirationDateInput = document.getElementById('expirationDate');
        expirationDateInput.value = formattedDate;
        expirationDateInput.min = formattedDate;

        const minimumAmountInput = document.getElementById('minPurchaseAmount');
        const maximumAmountInput = document.getElementById('maxPurchaseAmount');
        maximumAmountInput.min = minimumAmountInput.value;

        document.getElementById('generateCode').addEventListener('click', generateCode);
        document.getElementById('couponForm').addEventListener('submit', submitForm);

        const inputs = ['description', 'discountPercentage', 'minPurchaseAmount', 'maxPurchaseAmount', 'maxUsers'];
        inputs.forEach(id => {
            const input = document.getElementById(id);
            input.addEventListener('blur', () => validateInput(id));
            input.addEventListener('focus', clearErrorMessage);
        });
    });

    function generateCode() {
        const characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
        const codeLength = 8;
        let randomCode = '';

        for (let i = 0; i < codeLength; i++) {
            const randomIndex = Math.floor(Math.random() * characters.length);
            randomCode += characters.charAt(randomIndex);
        }

        document.getElementById('couponCode').value = randomCode;
    }

    function validateInput(inputId) {
        const input = document.getElementById(inputId);
        const errorElement = document.getElementById(inputId + 'Error');
        let isValid = true;

        switch(inputId) {
            case 'description':
                isValid = validateDescription();
                break;
            case 'discountPercentage':
                isValid = validateDiscountPercentage();
                break;
            case 'minPurchaseAmount':
            case 'maxPurchaseAmount':
                isValid = validateAmounts();
                break;
            case 'maxUsers':
                isValid = validateMaxUsers();
                break;
        }

        return isValid;
    }

    function validateDescription() {
        const description = document.getElementById('description').value.trim();
        const descriptionError = document.getElementById('descriptionError');
        if (description === '') {
            descriptionError.innerText = 'Description is required.';
            return false;
        } else if (description.length > 40) {
            descriptionError.innerText = 'Description must be less than 40 characters.';
            return false;
        } else if (!/^[a-zA-Z\s]*$/.test(description)) {
            descriptionError.innerText = 'Description should not contain numbers.';
            return false;
        } else {
            descriptionError.innerText = '';
            return true;
        }
    }

    function validateAmounts() {
        const minimumAmount = parseFloat(document.getElementById('minPurchaseAmount').value);
        const maximumAmount = parseFloat(document.getElementById('maxPurchaseAmount').value);
        const minimumAmountError = document.getElementById('minimumAmountError');
        const maximumAmountError = document.getElementById('maximumAmountError');

        if (isNaN(minimumAmount) || isNaN(maximumAmount) || minimumAmount < 0 || maximumAmount < 0) {
            minimumAmountError.innerText = 'Minimum and maximum amounts must be non-negative numbers.';
            maximumAmountError.innerText = 'Minimum and maximum amounts must be non-negative numbers.';
            return false;
        } else if (minimumAmount >= maximumAmount) {
            minimumAmountError.innerText = 'Minimum amount must be less than maximum amount.';
            maximumAmountError.innerText = 'Maximum amount must be greater than minimum amount.';
            return false;
        } else {
            minimumAmountError.innerText = '';
            maximumAmountError.innerText = '';
            return true;
        }
    }

    function validateDiscountPercentage() {
        const discountPercentageInput = document.getElementById('discountPercentage');
        const discountPercentage = parseFloat(discountPercentageInput.value.trim());
        const discountPercentageError = document.getElementById('discountPercentageError');

        if (discountPercentageInput.value.trim() === '') {
            discountPercentageError.innerText = "Discount percentage is required";
            return false;
        } else if (isNaN(discountPercentage) || discountPercentage < 5 || discountPercentage > 75) {
            discountPercentageError.innerText = "Discount percentage should be between 5% and 75%";
            return false;
        } else {
            discountPercentageError.innerText = "";
            return true;
        }
    }

    function validateMaxUsers() {
        const maxUsersInput = document.getElementById('maxUsers');
        const maxUsersError = document.getElementById('maxUsersError');
        const maxUsers = parseInt(maxUsersInput.value.trim());

        if (maxUsersInput.value.trim() === '') {
            maxUsersError.innerText = "Maximum users allowed is required";
            return false;
        } else if (isNaN(maxUsers) || maxUsers < 1 || maxUsers > 10) {
            maxUsersError.innerText = "Maximum users allowed should be between 1 and 10";
            return false;
        } else {
            maxUsersError.innerText = '';
            return true;
        }
    }

    function clearErrorMessage(event) {
        const input = event.target;
        const errorElement = document.getElementById(input.id + 'Error');
        errorElement.innerText = '';
    }

    function submitForm(event) {
        event.preventDefault();

        const isValid = validateDescription() && 
                        validateAmounts() && 
                        validateMaxUsers() && 
                        validateDiscountPercentage();

        if (!isValid) {
            document.getElementById('main-error').innerText = 'Please correct the errors in the form.';
            return;
        }

        addCoupon();
    }

    function addCoupon() {
        const formObject = {
            description: document.getElementById('description').value,
            name: document.getElementById('couponName').value,
            code: document.getElementById('couponCode').value,
            discountPercentage: document.getElementById('discountPercentage').value,
            minPurchaseAmount: document.getElementById('minPurchaseAmount').value,
            maxPurchaseAmount: document.getElementById('maxPurchaseAmount').value,
            expirationDate: document.getElementById('expirationDate').value,
            maxUsers: document.getElementById('maxUsers').value
        };

        fetch('/admin/createcoupon', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(formObject),
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.json();
        })
        .then(data => {
            if (data.success === true) {
                Swal.fire({
                    title: 'Success!',
                    text: 'Coupon created successfully.',
                    icon: 'success',
                    confirmButtonText: 'Cool'
                }).then(() => {
                    window.location.href = '/admin/coupon';
                });
            } else {
                throw new Error(data.message || 'Failed to create coupon');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            Swal.fire({
                title: 'Error!',
                text: error.message || 'Something went wrong!',
                icon: 'error',
                confirmButtonText: 'Try Again'
            });
        });
    }
</script>

</body>

</html>